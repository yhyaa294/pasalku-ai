'use client';

import React, { useState, useRef, useEffect } from 'react';
import { 
  Send, 
  Loader2, 
  Paperclip, 
  FileText, 
  TrendingUp, 
  Globe, 
  Download,
  Copy,
  Scale,
  AlertCircle,
  CheckCircle,
  XCircle
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { MessageItem } from './chat';
import { CitationCard } from './chat/CitationCard';
import { PredictionCard } from './chat/PredictionCard';
import { DocumentGeneratorModal } from './chat/DocumentGeneratorModal';
import { LanguageSwitcher } from './chat/LanguageSwitcher';
import { ExportChatModal } from './chat/ExportChatModal';

interface ChatMessage {
  id: string;
  content: string;
  role: 'user' | 'assistant' | 'error';
  timestamp: Date;
  status: 'sending' | 'sent' | 'failed';
  error?: string;
  attachments?: File[];
  attachmentsUrls?: string[];
  // Enhanced fields
  citations?: Citation[];
  predictions?: Prediction[];
  detectedLanguage?: string;
  translationAvailable?: boolean;
}

interface Citation {
  id: string;
  text: string;
  law: string;
  article: string;
  year?: string;
  isValid: boolean;
  formatted: string;
}

interface Prediction {
  id: string;
  outcome: string;
  confidence: number;
  reasoning: string;
  similarCases: number;
  risks: string[];
}

interface EnhancedChatInterfaceProps {
  isAuthenticated?: boolean;
  userRole?: 'public' | 'legal_professional' | 'admin';
  onClose?: () => void;
  onLoginRequired?: () => void;
  prefillInput?: string;
}

const quickResponses = [
  'Apa saja syarat membuat surat perjanjian yang sah?',
  'Bagaimana prosedur pengajuan gugatan perdata?',
  'Apa perbedaan antara KUHP dan KUHPerdata?',
  'Bagaimana cara mengajukan banding di pengadilan?',
  'Apa saja hak dan kewajiban dalam kontrak kerja?',
  'Bagaimana cara mengurus sertifikat tanah?'
];

const EnhancedChatInterface: React.FC<EnhancedChatInterfaceProps> = ({
  isAuthenticated = true, 
  userRole = 'public',
  onClose,
  onLoginRequired,
  prefillInput
}) => {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [input, setInput] = useState('');
  const [selectedLanguage, setSelectedLanguage] = useState('id');
  const [isLoading, setIsLoading] = useState(false);
  const [isTyping, setIsTyping] = useState(false);
  const [attachments, setAttachments] = useState<File[]>([]);
  const [showDocumentModal, setShowDocumentModal] = useState(false);
  const [showExportModal, setShowExportModal] = useState(false);
  const [autoTranslate, setAutoTranslate] = useState(false);
  
  const fileInputRef = useRef<HTMLInputElement>(null);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // Auto-scroll to bottom
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages, isTyping]);

  // Typing indicator
  useEffect(() => {
    if (isLoading) {
      const timer = setTimeout(() => setIsTyping(true), 500);
      return () => clearTimeout(timer);
    } else {
      setIsTyping(false);
    }
  }, [isLoading]);

  // Prefill input from query param
  useEffect(() => {
    if (prefillInput && !input) {
      setInput(prefillInput);
    }
    // run only once on mount or when prefill changes
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [prefillInput]);

  const detectCitations = async (text: string): Promise<Citation[]> => {
    try {
      const response = await fetch('/api/citations/extract', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      
      if (response.ok) {
        const data = await response.json();
        return data.citations || [];
      }
    } catch (error) {
      console.error('Citation detection error:', error);
    }
    return [];
  };

  const getPredictions = async (text: string): Promise<Prediction[]> => {
    try {
      const response = await fetch('/api/predictions/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          case_description: text,
          case_type: 'general'
        })
      });
      
      if (response.ok) {
        const data = await response.json();
        return [{
          id: data.prediction_id || 'pred-1',
          outcome: data.predicted_outcome || 'Unknown',
          confidence: data.confidence || 0.5,
          reasoning: data.reasoning || '',
          similarCases: data.similar_cases_count || 0,
          risks: data.key_factors || []
        }];
      }
    } catch (error) {
      console.error('Prediction error:', error);
    }
    return [];
  };

  const detectLanguage = async (text: string): Promise<string> => {
    try {
      const response = await fetch('/api/translation/detect', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      
      if (response.ok) {
        const data = await response.json();
        return data.detected_language || 'id';
      }
    } catch (error) {
      console.error('Language detection error:', error);
    }
    return 'id';
  };

  const translateMessage = async (text: string, sourceLang: string, targetLang: string): Promise<string> => {
    try {
      const response = await fetch('/api/translation/translate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          text,
          source_lang: sourceLang,
          target_lang: targetLang,
          preserve_legal_terms: true
        })
      });
      
      if (response.ok) {
        const data = await response.json();
        return data.translated_text || text;
      }
    } catch (error) {
      console.error('Translation error:', error);
    }
    return text;
  };

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>): void => {
    if (e.target.files && e.target.files.length > 0) {
      const newFiles = Array.from(e.target.files);
      setAttachments(prev => [...prev, ...newFiles]);
      e.target.value = '';
    }
  };

  const removeAttachment = (index: number): void => {
    setAttachments(prev => prev.filter((_, i) => i !== index));
  };

  const handleRetryMessage = async (messageId: string): Promise<void> => {
    const messageToRetry = messages.find(m => m.id === messageId);
    if (!messageToRetry || isLoading) return;

    setMessages(prev =>
      prev.map(m => (m.id === messageId ? { ...m, status: 'sending' } : m))
    );

    setIsLoading(true);

    try {
      // Get JWT token from localStorage
      const token = localStorage.getItem('token');
      if (!token) {
        throw new Error('No authentication token found');
      }

      // Use the new konsultasi endpoint
      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
      const response = await fetch(`${apiUrl}/api/v1/chat/konsultasi`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          query: messageToRetry.content,
          language: selectedLanguage
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.detail || 'Failed to retry message');
      }

      const data = await response.json();

      setMessages(prev =>
        prev.map(m =>
          m.id === messageId
            ? {
                ...m,
                status: 'sent',
                content: data.message || m.content,
              }
            : m
        )
      );
    } catch (error) {
      console.error('Retry failed:', error);
      setMessages(prev =>
        prev.map(m =>
          m.id === messageId
            ? { ...m, status: 'failed', error: 'Failed to retry' }
            : m
        )
      );
    } finally {
      setIsLoading(false);
    }
  };

  const copyToClipboard = async (text: string): Promise<void> => {
    try {
      await navigator.clipboard.writeText(text);
      // Show toast notification
    } catch (error) {
      console.error('Copy failed:', error);
    }
  };

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>): Promise<void> => {
    e.preventDefault();
    if ((!input.trim() && attachments.length === 0) || isLoading) return;

    if (!isAuthenticated) {
      onLoginRequired?.();
      return;
    }

    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      content: input,
      role: 'user',
      timestamp: new Date(),
      status: 'sending',
      attachments: [...attachments]
    };

    setMessages(prev => [...prev, userMessage]);
    const userInput = input;
    setInput('');
    setAttachments([]);
    setIsLoading(true);

    // Detect language
    const detectedLang = await detectLanguage(userInput);

    // Update user message
    setMessages(prev => 
      prev.map(msg => 
        msg.id === userMessage.id 
          ? { ...msg, status: 'sent', detectedLanguage: detectedLang }
          : msg
      )
    );

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>): Promise<void> => {
    e.preventDefault();
    if ((!input.trim() && attachments.length === 0) || isLoading) return;

    if (!isAuthenticated) {
      onLoginRequired?.();
      return;
    }

    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      content: input,
      role: 'user',
      timestamp: new Date(),
      status: 'sending',
      attachments: [...attachments]
    };

    setMessages(prev => [...prev, userMessage]);
    const userInput = input;
    setInput('');
    setAttachments([]);
    setIsLoading(true);

    // Detect language
    const detectedLang = await detectLanguage(userInput);

    // Update user message
    setMessages(prev => 
      prev.map(msg => 
        msg.id === userMessage.id 
          ? { ...msg, status: 'sent', detectedLanguage: detectedLang }
          : msg
      )
    );

    try {
      // Get JWT token from localStorage
      const token = localStorage.getItem('token');
      if (!token) {
        throw new Error('No authentication token found');
      }

      // Use the new konsultasi endpoint
      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
      const response = await fetch(`${apiUrl}/api/v1/chat/konsultasi`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          query: userInput,
          language: selectedLanguage
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.detail || 'Failed to send message');
      }

      const data = await response.json();

      // Extract citations from response
      const citations = await detectCitations(data.message);

      // Get predictions if relevant
      let predictions: Prediction[] = [];
      if (userInput.toLowerCase().includes('prediksi') || 
          userInput.toLowerCase().includes('kemungkinan') ||
          userInput.toLowerCase().includes('peluang')) {
        predictions = await getPredictions(userInput);
      }

      // Translate if needed
      let translatedContent = data.message;
      if (autoTranslate && detectedLang !== selectedLanguage) {
        translatedContent = await translateMessage(data.message, 'id', selectedLanguage);
      }

      const botMessage: ChatMessage = {
        id: `ai-${Date.now()}`,
        content: translatedContent,
        role: 'assistant',
        timestamp: new Date(),
        status: 'sent',
        citations,
        predictions,
        detectedLanguage: 'id',
        translationAvailable: detectedLang !== selectedLanguage,
        attachmentsUrls: data.attachments || []
      };

      setMessages(prev => [...prev, botMessage]);
    } catch (error) {
      console.error('Error:', error);
      
      setMessages(prev => 
        prev.map(msg => 
          msg.id === userMessage.id 
            ? { ...msg, status: 'failed', error: 'Failed to send message' }
            : msg
        )
      );

      const errorMessage: ChatMessage = {
        id: `error-${Date.now()}`,
        content: 'Terjadi kesalahan. Silakan coba lagi.',
        role: 'error',
        timestamp: new Date(),
        status: 'failed',
        error: 'Failed to send message'
      };
      
      setMessages(prev => [...prev, errorMessage]);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex flex-col h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50">
      {/* Enhanced Header - Modern & Professional */}
      <div className="bg-white/80 backdrop-blur-xl border-b border-gray-200/50 shadow-lg">
        <div className="bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 h-1"></div>
        <div className="flex justify-between items-center p-4">
          <div className="flex items-center space-x-3">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <Scale className="w-6 h-6 text-white" />
            </div>
            <div>
              <h1 className="text-xl font-bold text-gray-900">Pasalku AI</h1>
              <p className="text-xs text-gray-500 flex items-center gap-1">
                <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                Asisten Hukum Cerdas
              </p>
            </div>
          </div>
          
          <div className="flex items-center gap-2">
            {/* Language Switcher */}
            <LanguageSwitcher 
              selectedLanguage={selectedLanguage}
              onLanguageChange={setSelectedLanguage}
              autoTranslate={autoTranslate}
              onAutoTranslateChange={setAutoTranslate}
            />

            {/* Document Generator */}
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setShowDocumentModal(true)}
              className="text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all"
            >
              <FileText className="w-4 h-4 mr-1" />
              <span className="hidden sm:inline">Generate</span>
            </Button>

            {/* Export Chat */}
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setShowExportModal(true)}
              className="text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-all"
            >
              <Download className="w-4 h-4 mr-1" />
              <span className="hidden sm:inline">Export</span>
            </Button>

            {onClose && (
              <button 
                onClick={onClose}
                className="ml-2 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-all"
                aria-label="Close chat"
              >
                <XCircle className="w-5 h-5" />
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Messages Area - Modern Scrollbar */}
      <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 custom-scrollbar">
        {messages.length === 0 && !isLoading && (
          <>
            <div className="text-center py-12 animate-fade-in">
              <div className="relative inline-block mb-6">
                <div className="w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-2xl transform hover:scale-105 transition-transform">
                  <Scale className="w-12 h-12 text-white" />
                </div>
                <div className="absolute -top-2 -right-2 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center shadow-lg animate-pulse">
                  <span className="text-white text-xs font-bold">AI</span>
                </div>
              </div>
              <h2 className="text-3xl md:text-4xl font-extrabold text-gray-900 mb-3">
                Selamat Datang di <span className="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Pasalku AI</span>
              </h2>
              <p className="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">
                Asisten hukum pintar dengan <span className="font-semibold text-blue-600">Citation Detection</span>, 
                <span className="font-semibold text-purple-600"> Outcome Prediction</span>, dan 
                <span className="font-semibold text-green-600"> Multi-Language Support</span>
              </p>
              
              {/* Feature Highlights - Modern Cards */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-12">
                <div className="group bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg hover:shadow-2xl border-2 border-blue-100 hover:border-blue-300 transition-all duration-300 hover:-translate-y-1">
                  <div className="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg">
                    <Scale className="w-7 h-7 text-white" />
                  </div>
                  <h3 className="font-bold text-lg mb-2 text-gray-900">Auto Citations</h3>
                  <p className="text-sm text-gray-600 leading-relaxed">Deteksi & validasi otomatis legal citations dari database hukum Indonesia</p>
                </div>
                <div className="group bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg hover:shadow-2xl border-2 border-green-100 hover:border-green-300 transition-all duration-300 hover:-translate-y-1">
                  <div className="w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg">
                    <TrendingUp className="w-7 h-7 text-white" />
                  </div>
                  <h3 className="font-bold text-lg mb-2 text-gray-900">Predictions</h3>
                  <p className="text-sm text-gray-600 leading-relaxed">Prediksi outcome berdasarkan analisis data kasus historis</p>
                </div>
                <div className="group bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg hover:shadow-2xl border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 hover:-translate-y-1">
                  <div className="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg">
                    <Globe className="w-7 h-7 text-white" />
                  </div>
                  <h3 className="font-bold text-lg mb-2 text-gray-900">Multi-Language</h3>
                  <p className="text-sm text-gray-600 leading-relaxed">Support 6 bahasa dengan auto-translation real-time</p>
                </div>
              </div>
            </div>

            {/* Quick Responses - Modern Buttons */}
            <div className="max-w-4xl mx-auto">
              <p className="text-sm font-semibold text-gray-500 mb-4 flex items-center gap-2">
                <span className="w-1 h-4 bg-gradient-to-b from-blue-500 to-purple-500 rounded-full"></span>
                Pertanyaan Populer
              </p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {quickResponses.map((response, index) => (
                  <button
                    key={index}
                    onClick={() => setInput(response)}
                    className="group p-4 bg-white/80 backdrop-blur-sm rounded-xl shadow-md hover:shadow-xl border-2 border-gray-100 hover:border-blue-300 transition-all duration-300 text-left hover:-translate-y-1"
                    type="button"
                  >
                    <div className="flex items-start gap-3">
                      <div className="w-8 h-8 bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                        <span className="text-lg">ðŸ’¬</span>
                      </div>
                      <p className="text-sm font-medium text-gray-800 leading-relaxed group-hover:text-blue-600 transition-colors">{response}</p>
                    </div>
                  </button>
                ))}
              </div>
            </div>
          </>
        )}

        {/* Messages */}
        {messages.map((message) => {
          const isCurrentUser = message.role === 'user';
          return (
            <div key={message.id} className="space-y-2">
              <MessageItem
                message={message}
                isCurrentUser={isCurrentUser}
                onRetry={handleRetryMessage}
              />
              
              {/* Citations Display */}
              {message.citations && message.citations.length > 0 && (
                <div className="ml-12 space-y-2">
                  {message.citations.map((citation) => (
                    <CitationCard 
                      key={citation.id}
                      citation={citation}
                      onCopy={() => copyToClipboard(citation.formatted)}
                    />
                  ))}
                </div>
              )}

              {/* Predictions Display */}
              {message.predictions && message.predictions.length > 0 && (
                <div className="ml-12 space-y-2">
                  {message.predictions.map((prediction) => (
                    <PredictionCard 
                      key={prediction.id}
                      prediction={prediction}
                    />
                  ))}
                </div>
              )}

              {/* Translation Available Notice */}
              {message.translationAvailable && !autoTranslate && (
                <div className="ml-12 flex items-center space-x-2 text-xs text-blue-600">
                  <Globe className="w-4 h-4" />
                  <span>Translation available - Enable auto-translate in settings</span>
                </div>
              )}
            </div>
          );
        })}

        {/* Typing Indicator - Enhanced */}
        {isTyping && (
          <div className="flex items-start gap-3 animate-fade-in">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
              <Scale className="w-5 h-5 text-white" />
            </div>
            <div className="bg-white/80 backdrop-blur-sm rounded-2xl rounded-tl-sm px-6 py-4 shadow-lg border-2 border-blue-100">
              <div className="flex items-center space-x-2">
                <div className="flex space-x-1">
                  <div className="w-2.5 h-2.5 bg-blue-500 rounded-full animate-bounce"></div>
                  <div className="w-2.5 h-2.5 bg-purple-500 rounded-full animate-bounce [animation-delay:0.2s]"></div>
                  <div className="w-2.5 h-2.5 bg-blue-500 rounded-full animate-bounce [animation-delay:0.4s]"></div>
                </div>
                <span className="text-sm text-gray-600 font-medium ml-2">AI sedang menganalisis pertanyaan Anda...</span>
              </div>
            </div>
          </div>
        )}
        
        <div ref={messagesEndRef} />
      </div>

      {/* Input Area - Modern & Professional */}
      <div className="border-t border-gray-200/50 bg-white/80 backdrop-blur-xl shadow-2xl">
        <div className="p-4 md:p-6 max-w-5xl mx-auto">
          {/* Attachments Preview - Enhanced */}
          {attachments.length > 0 && (
            <div className="flex flex-wrap gap-3 mb-4 animate-fade-in">
              {attachments.map((file, index) => (
                <div key={index} className="group relative bg-gradient-to-br from-blue-50 to-purple-50 border-2 border-blue-200 rounded-xl px-4 py-3 shadow-md hover:shadow-lg transition-all">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center flex-shrink-0">
                      <Paperclip className="w-5 h-5 text-white" />
                    </div>
                    <div className="flex-1 min-w-0">
                      <p className="text-sm font-semibold text-gray-800 truncate">{file.name}</p>
                      <p className="text-xs text-gray-500">{(file.size / 1024).toFixed(1)} KB</p>
                    </div>
                    <button
                      onClick={() => removeAttachment(index)}
                      className="ml-2 p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100"
                      type="button"
                      aria-label={`Remove ${file.name}`}
                    >
                      <XCircle className="w-5 h-5" />
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}

          <form onSubmit={handleSubmit} className="flex gap-3">
            <div className="relative flex-1">
              <Input
                type="text"
                value={input}
                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setInput(e.target.value)}
                placeholder="Tanyakan sesuatu tentang hukum Indonesia..."
                className="w-full h-14 px-5 pr-14 text-base border-2 border-gray-200 rounded-2xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all shadow-sm hover:shadow-md"
                disabled={isLoading}
                aria-label="Type your legal question"
              />
              <input
                type="file"
                ref={fileInputRef}
                onChange={handleFileChange}
                className="hidden"
                multiple
                accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"
                aria-label="Upload files"
              />
              <button
                type="button"
                onClick={() => fileInputRef.current?.click()}
                className="absolute right-4 top-1/2 transform -translate-y-1/2 p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                disabled={isLoading}
                aria-label="Attach files"
                title="Lampirkan file (PDF, DOC, gambar)"
              >
                <Paperclip className={`w-5 h-5 ${isLoading ? 'opacity-50' : ''}`} />
              </button>
            </div>
            
            <Button 
              type="submit" 
              disabled={isLoading || (!input.trim() && attachments.length === 0)}
              className="h-14 px-8 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 hover:from-blue-700 hover:via-purple-700 hover:to-blue-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-base"
              aria-label="Send message"
            >
              {isLoading ? (
                <>
                  <Loader2 className="h-5 w-5 animate-spin" />
                  <span className="hidden sm:inline">Mengirim...</span>
                </>
              ) : (
                <>
                  <Send className="h-5 w-5" />
                  <span className="hidden sm:inline">Kirim</span>
                </>
              )}
            </Button>
          </form>
          
          {/* Helper Text */}
          <p className="text-xs text-gray-500 mt-3 text-center">
            ðŸ’¡ Tips: Jelaskan situasi hukum Anda dengan detail untuk hasil yang lebih akurat
          </p>
        </div>
      </div>

      {/* Modals */}
      {showDocumentModal && (
        <DocumentGeneratorModal 
          onClose={() => setShowDocumentModal(false)}
          conversationContext={messages}
        />
      )}

      {showExportModal && (
        <ExportChatModal 
          messages={messages}
          onClose={() => setShowExportModal(false)}
        />
      )}
    </div>
  );
}

export default EnhancedChatInterface;
